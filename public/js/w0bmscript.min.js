'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),API=function(){function API(){_classCallCheck(this,API)}return _createClass(API,null,[{key:'request',value:function request(a,b,c,d,f){var _this2=this;$.ajax({url:'/api/'+b+'/'+c,method:a?'POST':'GET',data:d,success:function success(g){'null'===g.error?f(!0,null,g.warnings,g):f(!1,_this2.responsify(g.error),g.warnings,g)},error:function error(g){return f(!1,null,null,g)}})}},{key:'responsify',value:function responsify(a){var b=function b(c,d){return{type:c,text:d}};return{not_logged_in:b('error','Not logged in'),invalid_request:b('error','Invalid request'),video_not_found:b('error','Video not found. Perhaps it has already been deleted'),insufficient_permissions:b('error','Insufficient permissions'),no_tags_specified:b('info','No tags specified')}[a]}}]),API}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}var Video=function(){function Video(){_classCallCheck(this,Video);var a=location.href.match(/(\d+)(?!.*\/.)/);a&&(this.id=a[1],this.user=$('.fa-info-circle').next().children().text().trim(),this.tags=$.makeArray($('#tag-display').children().children()).map(function(b){return b.innerText}).filter(function(b){return!!b}),this.api='video',this.apiBase=this.api+'/'+this.id)}return _createClass(Video,[{key:'tag',value:function tag(a,b){var c=this;a.length?API.request(!0,this.apiBase,'tag',{tags:a},function(f,g,h,j){f&&(c.tags=[],c.tags=j.tags.map(function(k){return k.name})),b(f,g,h,j)}):b(!1,API.responsify('no_tags_specified'),null,null)}},{key:'untag',value:function untag(a,b){var c=this;a=a.trim(),a?API.request(!0,this.apiBase,'untag',{tag:a},function(f,g,h,j){f&&(c.tags=[],c.tags=j.tags.map(function(k){return k.name})),b(f,g,h,j)}):b(!1,API.responsify('invalid_request'),null,null)}},{key:'delete',value:function _delete(a,b){a=a.trim(),a?API.request(!0,this.apiBase,'delete',{reason:a},b):b(!1,API.responsify('invalid_request'),null,null)}}]),Video}();var video;$(function(){video=new Video});function flash(a,b){var c=$('.flashcontainer > .container');'error'===a&&(a='danger'),c.append('<div class="alert alert-:TYPE: alert-dismissable" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>:REPLACE:</div>'.replace(/:TYPE:/,a).replace(/:REPLACE:/,b)),alertrm(jQuery)}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1000/60)}}(),Array.prototype.average=function(){var a=0;for(var b=0;b<this.length;b++)a+=this[b];return a/this.length};var videoElem=document.getElementById('video');if(null!==videoElem){var player,background,canvas,context,cw,ch;(function(){var a=function a(){videoElem.paused||videoElem.ended||!background||(context.drawImage(videoElem,0,0,cw,ch),window.requestAnimFrame(a))},b=function b(){var d=$('#next');'hidden'!=d.css('visibility')&&d.get(0).click()},c=function c(){var d=$('#prev');'hidden'!=d.css('visibility')&&d.get(0).click()};//Key Bindings
player=videojs(videoElem,{controls:!0,playbackRates:[0.25,0.5,1,1.5,2],inactivityTimeout:0,controlBar:{children:{playToggle:{},progressControl:{},currentTimeDisplay:{},timeDivider:{},durationDisplay:{},volumeControl:{},playbackRateMenuButton:{},fullscreenToggle:{}}}},function(){this.addClass('video-js'),this.volume(0.3),'undefined'!=typeof localStorage&&(this.volume(localStorage.getItem('volume')||0.3),this.on('volumechange',function(){localStorage.setItem('volume',this.volume())}))}),localStorage.getItem('background')==void 0&&($.browser.mobile?localStorage.setItem('background','false'):localStorage.setItem('background','true')),background='true'===localStorage.getItem('background'),canvas=document.getElementById('bg'),context=canvas.getContext('2d'),cw=canvas.width=0|canvas.clientWidth,ch=canvas.height=0|canvas.clientHeight,!background&&$(canvas).css('display','none'),videoElem.addEventListener('play',a),$('#togglebg').on('click',function(d){d.preventDefault(),background=!background,localStorage.setItem('background',background.toString()),background?$(canvas).css('display','block'):$(canvas).css('display','none'),a()}),$(document).on('keydown',function(d){d.defaultPrevented||d.target.nodeName.match(/\b(input|textarea)\b/i)||d.ctrlKey||d.altKey||d.shiftKey||(39==d.keyCode?b():37==d.keyCode?c():65==d.keyCode?c():68==d.keyCode?b():72==d.keyCode?c():76==d.keyCode?b():82==d.keyCode?$('#prev').next().get(0).click():70==d.keyCode?$('#fav').get(0).click():67==d.keyCode?$('.aside').fadeToggle(localStorage.comments='true'!=localStorage.comments):87==d.keyCode||38==d.keyCode?player.volume(player.volume()+0.1):83==d.keyCode||40==d.keyCode?player.volume(player.volume()-0.1):32==d.keyCode&&(player.paused()?player.play():player.pause()))}),$('.wrapper > div:not(.aside)').on('DOMMouseScroll mousewheel',function(d){d.ctrlKey||d.altKey||d.shiftKey||(d.preventDefault(),0>d.deltaY?b():c())})})()}else{var canvas=document.getElementById('bg');canvas.parentNode.removeChild(canvas)}function commentClickableTimestamp(a){if(a.preventDefault(),player){var b=$(a.target).text().match(/(\d{1,2}):(\d{2})/);if(b){var c=60*parseInt(b[1])+parseInt(b[2]);c<=player.duration()&&player.currentTime(c)}}}$(function(){$('.comment_clickable_timestamp').on('click',commentClickableTimestamp)}),function(a){function b(){var l=function l(m,n,o){return m.innerHTML=m.innerHTML.replace(n,o)};h.children().children(':first-of-type').each(function(m,n){l(n,/^nsfw$/i,function(o){return'<span style="color: red;">'+o+'</span>'}),l(n,/^sfw$/i,function(o){return'<span style="color: #23ff00;">'+o+'</span>'})})}function c(l){l.preventDefault(),confirm('Do you really want to delete this tag?')&&video.untag(a(this).siblings().text(),function(m,n,o,q){if(m){flash('success','Tag successfully deleted');var t=[];var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=q.tags[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var u=_step.value;t.push('<span class="label label-default"><a href="/songindex?q='+u.normalized+'" class="default-link">'+u.name+'</a> <a class="delete-tag default-link" href="#"><i class="fa fa-times"></i></a></span>')}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}h.empty(),h.append(t.join(' ')),a('.delete-tag').on('click',c),b()}else n?flash(n.type,n.text):flash('error','Unknown exception')})}a.ajaxSetup({headers:{'X-CSRF-TOKEN':a('meta[name="_token"]').attr('content')}});// Comments
var d=a('#commentForm');d.on('submit',function(l){l.preventDefault(),a.ajax({type:'POST',url:d.attr('action'),data:d.serialize()}).done(function(m){flash('success','Comment saved successfully'),a('.nocomments').remove();var n=a(m).appendTo('.commentwrapper').find('time.timeago');n.timeago(),n.tooltip(),n.closest('.panel-footer').siblings('.panel-body').find('.comment_clickable_timestamp').on('click',commentClickableTimestamp);var o=d.find('textarea').val('');o.blur()}).fail(function(m){flash('error','Error saving comment'),flash('error',m)})});//Tags
var f=a('#tags'),g=a('#submittags'),h=a('#tag-display');b(),a('.delete-tag').on('click',c),a('#tags, #filter').on('itemAdded',function(l){return setTimeout(function(){return a(l.currentTarget).siblings('.bootstrap-tagsinput').children('input').val('')},0)}),f.on('beforeItemAdd',function(l){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=video.tags[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var m=_step2.value;m.toLowerCase()===l.item.toLowerCase()&&(l.cancel=!0,flash('info','Tag already exists'))}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}),g.on('click touchdown',function(l){l.preventDefault(),video.tag(f.tagsinput('items'),function(m,n,o,q){if(m){flash('success','Tags saved successfully');var t=[];var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=q.tags[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var u=_step3.value;t.push('<span class="label label-default"><a href="/songindex?q='+u.normalized+'" class="default-link">'+u.name+'</a>'+(q.can_edit_video?' <a class="delete-tag default-link" href="#"><i class="fa fa-times"></i></a>':'')+'</span>')}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}h.empty(),h.append(t.join(' ')),f.tagsinput('removeAll'),a('.delete-tag').on('click',c),b()}else n?flash(n.type,n.text):flash('error','Unknown exception')})});// Filter
var j=a('#filter'),k=a('#submitfilter');k.on('click touchdown',function(l){l.preventDefault(),a.ajax({type:'POST',url:k.attr('href'),data:j.serialize()}).done(function(){flash('success','Filter successfully updated'),a('#filterselectmodal').modal('hide')}).fail(function(m){flash('error','Error updating tags')})})}(jQuery),function(a){function b(f,g){if(a('video').length){var h=[];g.interpret&&h.push(' <strong>Artist:</strong> '+g.interpret),g.songtitle&&h.push(' <strong>Songtitle:</strong> '+g.songtitle),g.imgsource&&h.push(' <strong>Video Source:</strong> '+g.imgsource),g.category.name&&h.push(' <strong>Category:</strong> '+g.category.name),a('span.fa-info-circle').attr('data-content',h.join('<br>'))}else{var j=f.parents('tr');j.find('span').show(),j.find('input, select').hide(),j.find('.vinterpret').html(g.interpret),j.find('.vsongtitle').html(g.songtitle),j.find('.vimgsource').html(g.imgsource),j.find('.vcategory').html('<a href="/'+g.category.shortname+'">'+g.category.name+'</a>')}}a.ajaxSetup({headers:{'X-CSRF-TOKEN':a('meta[name="_token"]').attr('content')}});var c=a('.indexform, #webmedit');if(a('.indexedit').find('input, select').hide(),c.length){var d=a('tr');d.on('dblclick touchdown',function(f){var g=a(this);g.find('input, select').show(),g.find('span').hide()})}c.on('submit',function(f){var g=a(this);f.preventDefault(),a.ajax({type:'POST',url:g.attr('action'),data:g.serialize()}).done(function(h){flash('success','Video successfully updated'),b(g,h),g.find('#webmeditmodal').modal('hide')}).fail(function(h){flash('error','Error updating video'),flash('error',h),g.find('#webmeditmodal').modal('hide')})})}(jQuery),function(a){a.ajaxSetup({headers:{'X-CSRF-TOKEN':a('meta[name="_token"]').attr('content')}});var b=a('#fav');b.on('click touchdown',function(c){c.preventDefault(),a.ajax({type:'GET',url:b.attr('href')}).done(function(d){flash('success',d);var f=b.find('i');f.hasClass('fa-heart-o')?(f.removeClass('fa-heart-o'),f.addClass('fa-heart')):(f.removeClass('fa-heart'),f.addClass('fa-heart-o'))})})}(jQuery),function(a){a('#togglebg').on('click touchdown',function(b){b.preventDefault(),a.ajax({dataType:'json',url:a(this).attr('href'),data:{}}).done(function(){a('#bg').toggle()})})}(jQuery),function(a){a(':not(form)[data-confirm]').on('click touchdown',function(){return confirm(a(this).data('confirm'))})}(jQuery),function(a){a('.comments, .tags').mCustomScrollbar({axis:'y',theme:'minimal',scrollInertia:0})}(jQuery);var alertrm=function alertrm(a){a('.alert').each(function(b){a(this).delay(3000+1000*b).slideUp(300)})};alertrm(jQuery),$('#categories').imagesLoaded(function(){$('#categories').isotope({itemSelector:'.category',percentPosition:!0,layoutMode:'masonry'})}),$(function(){$('[data-toggle="popover"]').popover({html:!0,trigger:'manual',container:$(this).attr('id'),placement:'top'}).on('mouseenter',function(){var a=this;$(this).popover('show'),$(this).siblings('.popover').on('mouseleave',function(){$(a).popover('hide')})}).on('mouseleave',function(){var a=this;setTimeout(function(){$('.popover:hover').length||$(a).popover('hide')},100)})}),function(){var a=document.getElementById('video');if(null!=a){var b=a.parentNode;b.style.marginBottom='3px';var c=document.createElement('div'),d=document.createElement('div');d.appendChild(c),b.appendChild(d),$(d).css({height:'3px',width:'100%',overflow:'hidden',willChange:'transform',position:'absolute',bottom:'0'}),$(c).css({height:'inherit',width:'inherit',position:'absolute',transform:'translateX(-100%)',backgroundColor:'rgba(31, 178, 176, 0.4)'});var f=function f(){if(requestAnimationFrame(f),!a.paused){var g=100/a.duration*a.currentTime;c.style.transform='translateX('+(-100+g)+'%)'}};f()}}(),function(a){var b=localStorage.comments;b===void 0&&(localStorage.comments=!0),b=b===void 0||'true'===b,a('.aside').toggle(b),a('#toggle').click(function(){a('.aside').fadeToggle(localStorage.comments='true'!=localStorage.comments)})}(jQuery);/\..+\/(?:songindex|user)/i.test(window.location.href)&&function(){var a=function a(b){return[b.clientX+$('div#thumb').width()>=$(window).width()?b.pageX-5-$('div#thumb').width():b.pageX+5,b.clientY+$('div#thumb').height()>=$(window).height()?b.pageY-5-$('div#thumb').height():b.pageY+5]};$(document).ready(function(){$('table tbody tr').on('mouseenter',function(b){var c=$(this).data('thumb'),d=a(b);$(document.body).prepend('<div id="thumb"></div>'),$('div#thumb').prepend('<img id="thumb"/>'),$('img#thumb').text('Loading...'),$('div#thumb').css({position:'absolute',left:d[0],top:d[1],'z-index':'5',border:'1px white solid','box-shadow':'5px 5px 7px 0px rgba(0,0,0,0.75)',color:'white','background-color':'#181818'});var f=$('img#thumb'),g=$('<img/>');g.load(function(){f.attr('src',$(this).attr('src')),d=a(b),$('div#thumb').css({left:d[0],top:d[1]})}),g.attr('src','https://w0bm.com/thumbs/'+c+'.gif')}).on('mousemove',function(b){$('div#thumb').css({left:a(b)[0],top:a(b)[1]})}).on('mouseleave',function(){$('#thumb').remove()})})}();//Pagination
var paginate=function paginate(a,b){var c=b.hash.type||'middle',d='',f=+a.pageCount,g=+a.page,h;b.hash.limit&&(h=+b.hash.limit);//page pageCount
var j={};switch(c){case'middle':if('number'==typeof h){var k=0,l=Math.ceil(h/2)-1,m=h-l-1;g+m>f&&(l=h-(f-g)-1),1>g-l&&(l=g-1);for(var n=g-l;k<h&&k<f;)j={n:n},n==g&&(j.active=!0),d=d+b.fn(j),n++,k++}else for(var k=1;k<=f;k++)j={n:k},k===g&&(j.active=!0),d=d+b.fn(j);break;case'previous':j=1==g?{disabled:!0,n:1}:{n:g-1},d=d+b.fn(j);break;case'next':j={},j=g==f?{disabled:!0,n:f}:{n:g+1},d=d+b.fn(j);break;case'first':j=1==g?{disabled:!0,n:1}:{n:1},d=d+b.fn(j);break;case'last':j=g==f?{disabled:!0,n:f}:{n:f},d=d+b.fn(j);}return d};//enable bootstrap tooltips and timeago
$(function(){var a=$.timeago.settings,b=a.strings;a.refreshMillis=1000,a.allowFuture=!0,a.localeTitle=!0,b.seconds='%d seconds',b.minute='1 minute',b.hour='1 hour',b.hours='%d hours',b.day='1 day',b.month='1 month',b.year='1 year',b.suffixFromNow=null,$('time.timeago').timeago(),$('[data-toggle="tooltip"]').tooltip()});// Notifications
var messagesBadge=$('ul.navbar-right > li > a > span.badge'),activeMessage;0<messagesBadge.text()&&messagesBadge.css('visibility','visible'),/\/user\/.+\/comments/i.test(location.href)?function(a){if('undefined'!=typeof Handlebars){a.ajaxSetup({headers:{'X-CSRF-TOKEN':a('meta[name="_token"]').attr('content')}}),Handlebars.registerHelper('paginate',paginate);var b=Handlebars.compile(a('#comlist').html()),c=Handlebars.compile(a('#paginationtmpl').html()),d=location.href.match(/\/user\/(.+)\/comments/i)[1],f=function f(g){var h='/api/comments';g||(g=h),a.getJSON(g,{username:d}).done(function(j){a('.spinner').hide(),a('#list').html(b(j)),a('time.timeago').timeago(),a('time[data-toggle="tooltip"]').tooltip();var k={pagination:{page:j.current_page,pageCount:j.last_page}};a('#pagination').html(c(k)),a('#pagination a').on('click touchdown',function(l){l.preventDefault(),f(h+'?page='+a(this).data('page'))})})};f()}// only on profilelayout
}(jQuery):function(a){if('undefined'!=typeof Handlebars&&a('#msglist').length){a.ajaxSetup({headers:{'X-CSRF-TOKEN':a('meta[name="_token"]').attr('content')}}),Handlebars.registerHelper('paginate',paginate);var b=Handlebars.compile(a('#msglist').html()),c=Handlebars.compile(a('#msgtmpl').html()),d=Handlebars.compile(a('#paginationtmpl').html()),f={},g=function g(h){var j='/api/messages';h||(h=j),a.getJSON(h).done(function(k){a('.spinner').hide(),f=k,a('#list').html(b(k)),'undefined'!=typeof activeMessage&&a('#listitems a[data-id="'+activeMessage+'"]').addClass('active');var l={pagination:{page:k.current_page,pageCount:k.last_page}};a('#pagination').html(d(l)),a('#pagination a').on('click touchdown',function(m){m.preventDefault(),g(j+'?page='+a(this).data('page'))}),a('#listitems a').on('click touchdown',function(m){m.preventDefault();var n=a(this),o=n.data('index');activeMessage=a(this).data('id'),a('#message').html(c(f.data[o])),f.data[o].read||a.post('/api/messages/read','m_ids[]='+n.data('id')).done(function(q){n.removeClass('list-group-item-info'),messagesBadge.text(messagesBadge.text()-1),0>=messagesBadge.text()&&messagesBadge.css('visibility','hidden')}),a('a').removeClass('active'),n.addClass('active'),a('time.timeago').timeago(),a('time[data-toggle="tooltip"]').tooltip()})})};g()}// only on profilelayout
}(jQuery);function readAll(){$.ajax({url:'/api/messages/readall',success:function success(a){1==a?(flash('success','Marked all messages as read'),$('.list-group-item-info').removeClass('list-group-item-info'),messagesBadge.text('0'),messagesBadge.css('visibility','hidden')):(flash('error','Failed to mark all messages as read'),flash('error',a))},error:function error(a,b,c){flash('error','Failed to mark all messages as read'),flash('error',b),flash('error',c)}})}$('ul.dropdown-menu').on('click touchdown',function(a){a.stopPropagation()});function deleteComment(a){var b=a.closest('div[data-id]'),c=b.data('id'),d=$(b.children('.panel-footer').children('a')[0]).text();do{var f=prompt('Reason for deleting comment '+c+' by '+d);if(null===f)return;f=f.trim()}while(!f);$.ajax({url:'/api/comments/'+c+'/delete',method:'POST',data:{reason:f},success:function success(g){'success'==g?(flash('success','Comment deleted'),b.removeClass('panel-default').addClass('panel-danger'),b.find('.panel-footer').children('a[onclick="deleteComment($(this))"]').replaceWith('<a href="#" onclick="restoreComment($(this))"><i style="color:green"; class="fa fa-refresh" aria-hidden="true"></i></a>'),b.find('.panel-footer > a[onclick="editComment($(this))"]').remove()):'invalid_request'==g?flash('error','Invalid request'):'not_logged_in'==g?flash('error','Not logged in'):'insufficient_permissions'==g?flash('error','Insufficient permissions'):flash('error','Unknown exception')},error:function error(g,h,j){flash('error','Unknwon exception'),flash('error',h),flash('error',j)}})}function restoreComment(a){var b=a.closest('div[data-id]'),c=b.data('id'),d=$(b.children('.panel-footer').children('a')[0]).text();do{var f=prompt('Reason for restoring comment '+c+' by '+d);if(null===f)return;f=f.trim()}while(!f);$.ajax({url:'/api/comments/'+c+'/restore',method:'POST',data:{reason:f},success:function success(g){'success'==g?(flash('success','Comment restored'),b.removeClass('panel-danger').addClass('panel-default'),b.find('.panel-footer').children('a[onclick]').replaceWith('<a href="#" onclick="deleteComment($(this))"><i style="color:red"; class="fa fa-times" aria-hidden="true"></i></a> <a href="#" onclick="editComment($(this))"><i style="color:cyan;" class="fa fa-pencil-square" aria-hidden="true"></i></a>')):'invalid_request'==g?flash('error','Invalid request'):'not_logged_in'==g?flash('error','Not logged in'):'insufficient_permissions'==g?flash('error','Insufficient permissions'):'comment_not_deleted'==g?flash('error','Comment is not deleted'):flash('error','Unknown exception')},error:function error(g,h,j){flash('error','Failed restoring comment'),flash('error',h),flash('error',j)}})}function editComment(a){var b=a.closest('div[data-id]'),c=b.find('.panel-body'),d=b.data('id');$.ajax({url:'/api/comments/'+d,success:function success(f){if('null'==f.error){var g=$('<textarea class="form-control">');c.replaceWith(g),g.val($('<div>').html(f.comment).text()),a.prev().remove(),a.replaceWith('<a href="#" class="saveCommentEdit"><i class="fa fa-floppy-o" aria-hidden="true"></i></a> <a href="#" class="abortCommentEdit"><i style="color:red;" class="fa fa-ban" aria-hidden="true"></i></a>'),b.find('.abortCommentEdit').on('click',function(h){h.preventDefault(),$(this).prev().remove(),$(this).replaceWith('<a href="#" onclick="deleteComment($(this))"><i style="color:red"; class="fa fa-times" aria-hidden="true"></i></a> <a href="#" onclick="editComment($(this))"><i style="color:cyan;" class="fa fa-pencil-square" aria-hidden="true"></i></a>'),g.replaceWith(c)}),b.find('.saveCommentEdit').on('click',function(h){h.preventDefault();var j=$(this);$.ajax({url:'/api/comments/'+d+'/edit',method:'POST',data:{comment:g.val()},success:function success(k){'null'==k.error?(c.html(k.rendered_comment),flash('success','Comment edited successfully'),c.find('.comment_clickable_timestamp').on('click',commentClickableTimestamp)):'invalid_request'==k.error?flash('error','Invalid request was sent by your browser'):'not_logged_in'==k.error?flash('error','Not logged in'):'insufficient_permissions'==k.error?flash('error','Insufficient permissions'):'comment_not_found'==k.error?flash('error','Comment does not exist'):flash('error','Unknown exception')},error:function error(k,l,m){flash('error','Unknown exception'),flash('error',l),flash('error',m)},complete:function complete(){g.replaceWith(c),j.next().remove(),j.replaceWith('<a href="#" onclick="deleteComment($(this))"><i style="color:red"; class="fa fa-times" aria-hidden="true"></i></a> <a href="#" onclick="editComment($(this))"><i style="color:cyan;" class="fa fa-pencil-square" aria-hidden="true"></i></a>')}})})}else'comment_not_found'==f.error?flash('error','Comment does not exist'):flash('error','Unknown exception')},error:function error(f,g,h){flash('error','Failed receiving non-rendered comment from API'),flash('error',g),flash('error',h)}})}$(function(){var a=$('.vjs-control-bar'),b=!1;$('video').on('mousemove',function(){b||(a.css('display','flex'),b=!0)}).on('mouseleave',function(c){$(c.relatedTarget).is('[class^="vjs"]')||!b||(a.hide(),b=!1)}),$('[class^="vjs"]').on('mouseleave',function(c){c.relatedTarget==$('video').get(0)||$(c.relatedTarget).is('[class^="vjs"]')||!b||(a.hide(),b=!1)})}),$(function(){if(/\/upload/.test(location.href)){var j,k,l,m,n,o,q;(function(){var a=function a(){$('#dragndrop').css({color:k,'border-color':l,'background-color':m})},b=function b(t){var u=Math.floor(Math.log(t)/Math.log(1024));return(t/Math.pow(1024,u)).toFixed(2)+' '+['B','kB','MB','GB','TB','PB','EB','ZB','YB'][u]},c=function c(t){t.preventDefault(),$('input[type="file"]').trigger('click')},d=function d(){$('#dragndrop-link').on('click',c),$('#dragndrop-link').attr('href','#'),$('#dragndrop-text').html(j)},f=function f(t){$('#dragndrop-link').removeAttr('href').off('click'),$('#dragndrop-text').html('<video id="video_preview" src="'+URL.createObjectURL(t)+'" autoplay controls loop></video><br><span class="upload-info">'+t.name+' &mdash; '+b(t.size)+' &mdash; <a id="dragndrop-clear" class="fa fa-times" href="#"></a></span><br><div class="progress progress-striped" style="display: none; margin-left: 10px; margin-right: 10px;"><div class="progress-bar progress-bar-custom" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"><span class="upload-info sr-only">0%</span></div></div><span class="upload-info"><span id="upload-stats" style="display: none;"></span></span>'),$('#video_preview').prop('volume',0),$('#dragndrop-clear').on('click',function(u){u.preventDefault(),u.stopPropagation(),o=null,$(this).off('click'),a(),d(),q&&'abort'!=q.statusText&&(q.abort(),q=null)})},g=function g(t){var u=31457280<t.size,w='video/webm'!==t.type;return u&&$('#dragndrop').data('uploadlimit')||w?(flash('error',w?'Invalid file':'File too big. Max 30MB'),a(),!1):!0},h=function h(t,u,w,y,z){function A(){var G=0,H=C.length,I;for(I=D;I<H;I++)G+=C[I];G=G/(I-D),D=I,$('#upload-stats').text('Speed: '+b(Math.floor(G))+'/s Uploaded: '+b(B.loaded))}var B={loaded:0,secondsElapsed:0},C=[],D=0,E,F=new FormData;F.append('interpret',t),F.append('songtitle',u),F.append('imgsource',w),F.append('category',y),F.append('file',z),$('.progress-striped, #upload-stats').css('opacity',0).slideDown('fast').animate({opacity:1},{queue:!1,duration:'fast'}),q=$.ajax({url:'/api/upload',type:'POST',data:F,processData:!1,contentType:!1,success:function success(G){switch(G.error){case'null':G.video_id?(flash('success','Upload successful: <a href="/'+G.video_id+'">/'+G.video_id+'</a>. Redirect in 3 seconds...'),setTimeout(function(){location.href='/'+G.video_id},3000)):flash('error','Unexpected Exception');break;case'invalid_request':flash('error','Invalid request');break;case'not_logged_in':flash('error','Not logged in');break;case'uploadlimit_reached':flash('error','Uploadlimit reached');break;case'invalid_file':flash('error','Invalid file');break;case'file_too_big':flash('error','File too big. Max 30MB');break;case'already_exists':G.video_id?flash('error','Video already exists: <a href="/'+G.video_id+'">/'+G.video_id+'</a>'):flash('error','Video already existed but has been deleted');break;case'erroneous_file_encoding':flash('error','Erroneous file encoding. <a href="/webm">Try reencoding it</a>');break;default:flash('error','Unexpected exception');}'null'!=G.error&&($('.progress-bar-custom').css('background-color','red'),$('.progress-bar-custom').text('Upload failed')),$('#upload-stats').text('Speed: '+b(Math.floor(C.average()))+'/s Uploaded: '+b(o.size))},error:function error(G,H,I){return G=null,'abort'==I?void flash('info','Upload aborted'):void(flash('error','Upload failed'),flash('error',H),flash('error',I))},complete:function complete(){clearInterval(E)},xhr:function xhr(){var G=$.ajaxSettings.xhr(),H=new Date;return $('.progress-bar-custom').css('background-color','rgba(47, 196, 47, 1)'),G.upload.onprogress=function(I){var J=Math.floor(100*(I.loaded/I.total)),K=(new Date().getTime()-H.getTime())/1000,L=(I.loaded-B.loaded)/(K-B.secondsElapsed);$('.progress-bar-custom').css('width',J+'%'),$('.progress-bar-custom').text(J+'%'),B.secondsElapsed=K,B.loaded=I.loaded,C.push(L),E||(A(),E=setInterval(A,500))},G}})};j=$('#dragndrop-text').html(),k=$('#dragndrop').css('color'),l=$('#dragndrop').css('border-left-color'),m=$('#dragndrop').css('background-color'),n=0,$('input[type="file"]').on('change',function(t){if(this.files.length){var u=this.files[0];g(u)&&(o=u,f(u)),$(this).wrap('<form>').closest('form').get(0).reset(),$(this).unwrap()}}),$('#dragndrop-link').on('click',c),$(document).on('dragenter',function(t){t.preventDefault(),n++;var u=t.originalEvent.dataTransfer;null!=u.types&&(u.types.indexOf?0===u.types.indexOf('Files'):u.types.contains('application/x-moz-file'))&&$('#dragndrop').css({color:'#BBB','border-color':'#656464','background-color':'#323234'})}).on('dragleave',function(){n--,0===n&&a()}).on('dragover',function(t){t.preventDefault()}).on('drop',function(t){t.preventDefault(),$(t.target).is('#dragndrop-text')||a()}),$('#dragndrop-text').on('dragover',function(t){var u=t.originalEvent.dataTransfer,w=u.effectAllowed;u.dropEffect='move'===w||'linkMove'===w?'move':'copy'}).on('drop',function(t){if(t.originalEvent.dataTransfer.files.length){q&&'abort'!=q.statusText&&(q.abort(),o=null,d());var u=t.originalEvent.dataTransfer.files[0];a(),g(u)&&(o=u,f(u),n=0)}}),$('button#btn-upload').on('click',function(){return o?q&&(0==q.readyState||1==q.readyState||3==q.readyState)?void flash('info','Already uploading'):void h($('#interpret').val(),$('#songtitle').val(),$('#imgsource').val(),$('#category').val(),o):void flash('error','No file selected')})})()}}),$(function(){$('#delete_video').on('click',function(a){a.preventDefault();do{var b=prompt('Reason for deleting video '+video.id+' by '+video.user);if(null===b)return;b=b.trim()}while(!b);video.delete(b,function(c,d,f){if(c){flash('success','Video deleted. Redirect in 3 seconds...'),setTimeout(function(){return location.href='/'},3000);var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=f[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var g=_step4.value;flash('warning',g)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}}else d?flash(d.type,d.text):flash('error','Unknown exception')})})});
